<!DOCTYPE html>
<html>
<head>
    <title>HomeMatch Setup Validator</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .success { color: #0f0; }
        pre { background: #000; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>HomeMatch Setup Validator</h1>
    <pre id="output">Running validation checks...</pre>

    <script>
        const output = document.getElementById('output');
        const log = (msg, type = '') => {
            const line = document.createElement('div');
            line.className = type;
            line.textContent = msg;
            output.appendChild(line);
        };

        async function validate() {
            output.innerHTML = '';
            log('=== HomeMatch Setup Validator ===\n');

            // Check 1: Settings in localStorage
            log('1. Checking localStorage...');
            const settings = localStorage.getItem('homematchSettings');
            if (settings) {
                const parsed = JSON.parse(settings);
                log(`   ✓ Found settings with ${parsed.neighborhoods?.length || 0} neighborhoods`, 'success');
            } else {
                log('   ⚠ No saved settings found (normal for first run)', 'warning');
            }

            // Check 2: API endpoint
            log('\n2. Testing Zillow API endpoint...');
            try {
                const response = await fetch('/api/zillow-search?location=Palo Alto, CA');
                const data = await response.json();
                if (response.ok) {
                    log(`   ✓ API working! Found ${data.totalResultCount || 0} properties`, 'success');
                } else {
                    log(`   ✗ API error: ${data.error || response.status}`, 'error');
                }
            } catch (e) {
                log(`   ✗ Network error: ${e.message}`, 'error');
            }

            // Check 3: File structure
            log('\n3. Checking required endpoints...');
            const endpoints = [
                '/api/zillow-search',
                '/api/swipe',
                '/frontend/index.html',
                '/frontend/settings.html',
                '/frontend/css/styles.css',
                '/frontend/js/settings.js'
            ];

            for (const endpoint of endpoints) {
                try {
                    const resp = await fetch(endpoint, { method: 'HEAD' });
                    if (resp.ok || resp.status === 405) { // 405 is OK for POST-only endpoints
                        log(`   ✓ ${endpoint}`, 'success');
                    } else {
                        log(`   ✗ ${endpoint} (${resp.status})`, 'error');
                    }
                } catch (e) {
                    log(`   ⚠ ${endpoint} (check failed)`, 'warning');
                }
            }

            // Check 4: Redundant files
            log('\n4. Checking for redundant files...');
            const redundant = ['/api/neighborhoods.js', '/api/properties.js'];
            for (const file of redundant) {
                try {
                    const resp = await fetch(file, { method: 'HEAD' });
                    if (resp.ok) {
                        log(`   ⚠ ${file} exists but should be deleted`, 'warning');
                    } else {
                        log(`   ✓ ${file} not found (good!)`, 'success');
                    }
                } catch (e) {
                    log(`   ✓ ${file} not found (good!)`, 'success');
                }
            }

            log('\n=== Validation Complete ===');
        }

        // Run validation on load
        validate();
    </script>
</body>
</html>